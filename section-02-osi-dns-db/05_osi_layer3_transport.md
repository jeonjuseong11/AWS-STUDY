# OSI 7 Layer - 4계층: 전송 계층(Transport Layer)

## 1. 전송 계층(Transport Layer) 개요 및 필요성

- **위치:** OSI 7계층 중 4번째
- **단위:** 세그먼트(Segment)
- **목적:** 네트워크 계층에서 해결하지 못한 신뢰성/동시성 문제를 해결하고, 데이터 전달의 신뢰성을 확보

### 네트워크 계층의 한계

- 동시 통신 불가: 하나의 IP에서 여러 애플리케이션을 구분하지 못함
- 순서/유실 보장 불가: 데이터 순서 보장, 유실 복구 불가

### 전송 계층의 주요 기능

- **패킷 순서 보장:** 올바른 순서로 데이터 재조립
- **에러 처리:** 유실, 손상 등 에러 감지 및 복구
- **포트 기반 분할:** 하나의 IP 내 여러 애플리케이션 동시 통신 지원

---

## 2. 주요 프로토콜: TCP와 UDP

### 2.1. TCP (Transmission Control Protocol)

- **연결 지향(Connected) 프로토콜:** 통신 전 연결 설정(3-Way Handshake) 필요
- **신뢰성(Reliability):** 데이터 무결성, 전달 여부를 확인(ACK)
- **순서 보장:** 시퀀스 넘버(Sequence Number) 사용
- **흐름 제어/혼잡 제어:** 윈도우 크기(Window Size) 활용
- **복잡, 상대적으로 느림:** 신뢰성 확보 절차(재전송, 흐름제어 등) 때문에
- **주요 사용:** HTTP/HTTPS(웹), 이메일, 파일전송, SSH 등

#### TCP 세그먼트 구조

- 소스 포트 / 대상 포트
- 시퀀스 넘버 / ACK 넘버
- 플래그(SYN, ACK, FIN 등)
- 윈도우 크기
- 체크섬
- 데이터(애플리케이션 데이터)

#### 3-Way Handshake

1. **SYN:** 클라이언트 → 서버 (연결 요청, Seq=CS)
2. **SYN-ACK:** 서버 → 클라이언트 (연결 응답, Seq=SS, Ack=CS+1)
3. **ACK:** 클라이언트 → 서버 (연결 확인, Ack=SS+1)

> **핵심:** "받았는지 안 받았는지 체크하며, 순서 보장!"

---

### 2.2. UDP (User Datagram Protocol)

- **비연결(Connectionless) 프로토콜:** 연결 설정 없음, 빠르고 단순
- **비신뢰성:** 순서, 유실, 중복 검증 안함
- **오버헤드 적음:** 헤더가 매우 간단, 지연 최소화
- **주요 사용:** 실시간 스트리밍, 음성통화(VoIP), 온라인 게임, DNS, DHCP 등

#### UDP 세그먼트 구조

- 소스 포트 / 대상 포트
- 길이(Length)
- 체크섬
- 데이터

---

## 3. 포트(Port) 개념

- 하나의 IP 주소 내 여러 애플리케이션이 동시 통신할 수 있도록 구분하는 논리적 단위
- **범위:** 0~65535 (2^16)
- **종류**
  - **웰논 포트(Well-known Port):** 표준 프로토콜/서비스용(HTTP: 80, HTTPS: 443, SSH: 22, MySQL: 3306 등)
  - **에페머럴 포트(Ephemeral Port):** 클라이언트가 임시로 할당받아 사용하는 포트

### 포트 활용 예시

- 클라이언트 웹브라우저(임시포트 3311) → 서버(80):  
  요청: 소스포트 3311, 대상포트 80  
  응답: 소스포트 80, 대상포트 3311
- **덕분에 여러 앱/클라이언트가 동시에 같은 서버와 통신 가능!**

---

## 4. 실전 활용 (AWS 등 클라우드 환경 예시)

- **Elastic Load Balancer**
  - **Network Load Balancer(NLB):** OSI 4계층(전송 계층, TCP/UDP)에서 동작
  - **Application Load Balancer(ALB):** OSI 7계층(애플리케이션 계층)에서 동작
- **보안 그룹/Security Group, NACL:** 인바운드/아웃바운드 포트 기준 방화벽 설정

---

## 5. 요약 및 시사점

- **전송 계층:** 신뢰성과 다중 애플리케이션 통신을 실현하는 핵심 계층
- **TCP:** 신뢰성·정확성 중시(웹, 메일 등), 느리지만 안전
- **UDP:** 속도·효율성 중시(실시간 서비스), 빠르지만 데이터 유실/순서 뒤바뀜 가능
- **포트:** 하나의 IP에서 여러 서비스 동시 운용 가능
- **AWS/클라우드 인프라 설계:** 전송 계층 이해가 필수
