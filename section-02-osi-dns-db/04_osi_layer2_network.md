# OSI 7 Layer - 3계층: 네트워크 레이어(Network Layer)

## 1. 네트워크 레이어란?

- OSI 7계층 중 **3번째 계층**
- **역할:** 서로 다른 로컬 네트워크(LAN) 간의 통신, 데이터 경로 설정(라우팅), 논리적 주소(IP) 관리
- **주요 단위:** 패킷(Packet)
- **주요 구성 요소:** 라우터(Router), IP(Internet Protocol), ARP(Address Resolution Protocol)

### 주요 기능

- **경로 설정(라우팅, Routing):** 중간 노드를 거쳐 목적지까지 도달하는 방법을 정의
- **논리적 주소 지정(IP Addressing):** 통신 대상 식별을 위한 IP 주소 사용

---

## 2. IP 주소 (Internet Protocol Address)

- 네트워크상 통신 대상 식별을 위한 고유 주소

### 2.1. IPv4

- **32비트** (약 43억 개 주소)
- **표현:** `192.168.2.0` (8비트×4, 0~255)
- **특징:** 주소 고갈 → **공인 IP/사설 IP** 개념

### 2.2. IPv6

- **128비트** (사실상 무한대)
- **특징:** 주소 고갈 없음, **사설 IP 불필요**

### 2.3. CIDR (Classless Inter-Domain Routing)

- IP를 네트워크/호스트 영역으로 효율적으로 나누는 방식
- **표기법:** `a.b.c.d/e`
  - 예) `192.168.2.0/24`
    - 네트워크 비트: 앞 24비트(192.168.2)
    - 호스트 비트: 뒤 8비트(0~255)

### 2.4. 서브넷 마스크(Subnet Mask)

- IP에서 네트워크/호스트 비트 구분
- **사용:** IP와 AND 연산으로 네트워크 주소 추출
- **목적:** 같은 로컬 네트워크(=같은 가족) 여부 판단

---

## 3. 라우터(Router)

- **역할:** 네트워크 간 패킷 전달(3계층 장비)
- **주요 기능**
  - 최적 경로 수집 및 관리 (라우트 테이블)
  - 패킷 전달: 로컬 네트워크 외 IP로 온 패킷을 적절한 다음 라우터로 전달
  - **프레임 재구성:** 패킷을 새로운 MAC 주소로 감싸서 전달

---

## 4. ARP (Address Resolution Protocol)

- **IP주소 → MAC주소 변환** 역할(3계층 ↔ 2계층 연결)
- **동작 순서:**
  1. ARP 요청을 네트워크 전체에 브로드캐스트
  2. 해당 IP를 가진 장치가 ARP 응답(MAC주소) 전송
  3. 송신자는 매핑정보(ARP테이블) 저장

---

## 5. 네트워크 통신 과정 예시

1. **출발지(클라이언트)**

   - 목적지 IP가 자기 네트워크와 다르면, 라우터로 패킷 전송(라우터 MAC주소를 알아야 하므로 ARP 활용)
   - 네트워크 계층: 패킷 생성(소스 IP, 목적지 IP, 데이터)
   - 데이터링크 계층: 라우터 MAC주소로 프레임 생성

2. **라우터(중간 경로)**

   - 프레임 → 패킷 추출 → 목적지 IP 확인
   - 목적지 IP가 로컬 네트워크 범위 밖이면, 라우트 테이블 참조해 다음 라우터로 전달
   - 이 과정 반복(패킷은 변하지 않음, 프레임의 MAC주소는 매번 갱신)

3. **도착지 라우터/수신자**
   - 패킷의 목적지 IP가 자기 네트워크 범위 내에 들어오면, 수신자의 MAC 주소로 프레임 캡슐화해서 전달
   - 최종 수신자는 프레임을 해제하고, 상위 계층으로 데이터 전달

> **중요:**
>
> - "패킷은 중간 경로를 거치면서 내용이 변하지 않음"
> - "프레임(MAC주소)는 매 라우터마다 변함"

---

## 6. 네트워크 레이어의 한계

- **동시 통신 구분 불가:** 포트번호(애플리케이션 식별)가 없음 → 여러 앱 동시 통신 X
- **순서 보장/유실 복구 불가:** 패킷 유실·순서 뒤바뀜 감지/복구 기능 없음

이러한 한계는 **전송 계층(4계층, TCP/UDP)**에서 보완됨
